<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chipotle Market Strategy Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --chipotle-red: #A81612;
            --chipotle-brown: #451400;
            --chipotle-green: #91cc75;
            --bg-dark: #1a1a1a;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            overflow: hidden;
        }

        h1, h2, h3, .tab-btn, .navbar-brand {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
        }

        /* === Scroll container === */
        .scroll-container {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }

        .viewport {
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* === Navbar styling tweaks === */
        .fixed-nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85); /* Darker background to highlight buttons */
            backdrop-filter: blur(10px);
            padding: 15px 0;
        }

        .navbar-brand {
            color: white !important;
            letter-spacing: 1px;
            font-size: 1.5rem;
        }

        /* Navigation button styles */
        .nav-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.8);
            padding: 8px 20px;
            margin-left: 15px;
            border-radius: 30px; /* Capsule shape */
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            text-decoration: none; /* Remove underline */
            cursor: pointer;
        }

        .nav-btn:hover {
            background-color: var(--chipotle-red);
            border-color: var(--chipotle-red);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(168, 22, 18, 0.4);
        }

        /* === Section backgrounds === */
        #vp-macro { background-color: #fff; }
        #vp-deep-dive { background-color: var(--bg-dark); color: white; flex-direction: column; padding-top: 60px; }
        #vp-voice {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1627308595229-7830a5c91f9f?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            color: white;
        }

        /* === Tab system === */
        .tabs-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 10;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: #888;
            font-size: 1.5rem;
            padding: 10px 30px;
            margin: 0 15px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .tab-btn:hover { color: #fff; }

        .tab-btn.active {
            color: #fff;
            text-shadow: 0 0 10px rgba(145, 204, 117, 0.5);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--chipotle-green);
            box-shadow: 0 0 10px var(--chipotle-green);
            animation: expandWidth 0.3s ease;
        }

        @keyframes expandWidth {
            from { width: 0; left: 50%; }
            to { width: 100%; left: 0; }
        }

        .tab-content-container {
            width: 90%;
            height: 75vh;
            position: relative;
        }

        .tab-pane {
            display: none;
            width: 100%;
            height: 100%;
            animation: fadeIn 0.5s ease;
        }

        .tab-pane.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === Chart containers === */
        .chart-card-dark {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            height: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .split-layout { display: flex; gap: 20px; width: 100%; height: 100%; }
        .split-left, .split-right { flex: 1; height: 100%; }

        .img-fluid-contain {
            max-width: 100%;
            max-height: 85%;
            object-fit: contain;
            border-radius: 10px;
        }

        .trend-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
            background: white;
        }

        /* Highlighted text styles */
        .highlight-insight {
            border-left: 4px solid var(--chipotle-red);
            padding-left: 15px;
            margin-top: 20px;
            font-style: italic;
            color: #555;
        }
        .text-panel {
    background: rgba(0, 0, 0, 0.4);
    border-left: 4px solid #ee6666; /* Border also in red */
    padding: 25px;
    border-radius: 0 15px 15px 0;
    backdrop-filter: blur(5px);
}

        /* Ensure tab content has padding and is not edge-to-edge */
        .tab-content-container {
            width: 95%; /* Slightly wider since layout uses three columns */
            height: 70vh; /* Slightly lower height to avoid overflowing the viewport */
            position: relative;
            margin-top: 20px;
        }
        .text-highlight {
    color: #ee6666; /* Brighter red to read clearly on dark background */
    font-weight: 700;
    font-size: 1.05rem;
    text-shadow: 0 0 10px rgba(238, 102, 102, 0.4); /* Soft red glow effect */
}
        .text-body-read {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
    line-height: 1.6;
}
.chart-note {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.4); /* Very subtle gray */
    font-style: italic;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1); /* Add a very thin divider line */
}
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-nav">
  <div class="container">
    <a class="navbar-brand" href="#">üåØ Chipotle Strategy</a>
    <div class="navbar-nav ms-auto d-flex flex-row">
      <button class="nav-btn" onclick="scrollToSection('vp-macro')">MARKET OVERVIEW</button>
      <button class="nav-btn" onclick="scrollToSection('vp-deep-dive')">DEEP ANALYSIS</button>
      <button class="nav-btn" onclick="scrollToSection('vp-voice')">CUSTOMER VOICE</button>
    </div>
  </div>
</nav>

<div class="scroll-container" id="mainContainer">

    <section class="viewport" id="vp-macro">
        <div class="container h-100">
            <div class="row align-items-center h-100">
                <div class="col-lg-4">
    <h1 class="display-3 fw-bold mb-3" style="color: var(--chipotle-brown);">Share of Voice</h1>

    <p class="lead text-muted">
        Based on <strong>Total Review Volume</strong>, Chipotle dominates the Northeast and South.
    </p>

    <div class="highlight-insight">
        <p class="mb-0">
            However, the <strong>Midwest</strong> remains a contested battleground where
            <span style="color: #73c0de; font-weight: bold;">Qdoba</span>
            captures a significant portion of customer attention.
        </p>
    </div>

    <div class="mt-3">
        <p class="small text-secondary" style="font-style: italic; opacity: 0.7;">
            * Note: Review Share serves as a proxy for foot traffic and brand dominance in the region.
        </p>
    </div>

    <div class="mt-4">
        <p class="small text-muted text-uppercase" style="letter-spacing: 2px;">Scroll Down for Deep Dive ‚ñº</p>
    </div>
</div>
                <div class="col-lg-8" style="height: 70vh;">
                    <div id="scatter_chart" style="width:100%; height:100%;"></div>
                </div>
            </div>
        </div>
    </section>

    <section class="viewport" id="vp-deep-dive">

        <div class="tabs-nav">
            <button class="tab-btn active" onclick="openTab(event, 'tab-sentiment')">1. CUSTOMER</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-financial')">2. FINANCIAL</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-trend')">3. TRENDS</button>
        </div>

        <div class="tab-content-container">

            <div id="tab-sentiment" class="tab-pane active">
                <div class="row h-100 align-items-center g-4"> <div class="col-lg-3 h-100">
    <div class="text-panel h-100 d-flex flex-column justify-content-center">

        <h3 class="mb-3" style="color: #ee6666; letter-spacing: 1px;">
            DRIVERS OF SATISFACTION
        </h3>

        <p class="text-body-read mb-3">
            While category ratings remain generally <span class="text-highlight">low (2.8 avg)</span>,
            <span class="text-highlight">Chipotle trails its direct competitors</span> in most regions.
            Guests clearly distinguish between the value of the core product and the
            <span class="text-highlight">end-to-end service experience</span>.
        </p>

        <h5 class="text-uppercase mt-2 mb-2" style="color: #ee6666; font-size: 0.95rem; font-weight:bold; letter-spacing: 1px;">
            The Pain Points
        </h5>
        <p class="text-body-read mb-0">
            Keywords like <span class="text-highlight">"30 Minutes"</span> and <span class="text-highlight">"Online Order"</span>
            dominate negative feedback, confirming that operational bottlenecks rather than taste are the primary detractors.
            Additionally, topics such as <span class="text-highlight">"Chips Stale"</span> highlight intermittent quality control failures.
        </p>

        <div class="chart-note">
            * Note: Longer bars in the Voice of Customer chart represent higher importance scores, highlighting which specific topics exert the strongest impact on overall sentiment trends.
        </div>

    </div>
</div>

                    <div class="col-lg-4 h-100">
                        <div class="chart-card-dark">
                            <h6 class="text-center text-muted text-uppercase mb-2" style="letter-spacing: 1px; font-size: 0.8rem;">Regional Ratings</h6>
                            <div id="bar_chart" style="width:100%; height:90%;"></div>
                        </div>
                    </div>

                    <div class="col-lg-5 h-100">
                        <div class="chart-card-dark">
                            <h6 class="text-center text-muted text-uppercase mb-2" style="letter-spacing: 1px; font-size: 0.8rem;">Voice of Customer (NLP)</h6>
                            <div id="sentiment_chart" style="width:100%; height:90%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-financial" class="tab-pane">
    <div class="row h-100 align-items-center g-5"> <div class="col-lg-4 h-100 d-flex flex-column justify-content-center">
    <div class="text-panel" style="background: rgba(0,0,0,0.2); border-left: 4px solid #fac858; padding: 30px; backdrop-filter: blur(5px);">

        <h3 class="mb-3 text-uppercase" style="color: #fac858; letter-spacing: 1px;">
            THE PROFIT PARADOX
        </h3>

        <p class="text-body-read mb-4">
            Post-2020 data reveals a critical divergence:
            <span class="text-white fw-bold">Operating Margins hit record highs</span>,
            while <span style="color:#91cc75; font-weight:bold;">Customer Sentiment</span> plunges to historic lows.
        </p>

        <hr style="border-color: rgba(255,255,255,0.1); margin: 20px 0;">

        <div class="mb-4">
            <strong style="color: #ee6666; font-size: 1.1rem;">üî• The Root Cause: Overload</strong>
            <p class="small text-white-50 mt-2" style="line-height: 1.6;">
                <strong>Store Share remained flat</strong> (no new capacity) while
                <strong>Revenue skyrocketed</strong> (surging demand).
            </p>
            <p class="small text-white-50 mt-2" style="line-height: 1.6;">
                This forced existing locations to handle massive volume spikes without infrastructure expansion, resulting in
                <strong>operational burnout</strong> and degraded service quality.
            </p>
        </div>

        <div class="mb-0 p-3" style="background: rgba(255,255,255,0.05); border-radius: 8px;">
            <p class="small text-white mb-1" style="font-family: monospace;">
                High Volume <span style="color:#91cc75;">‚Üë</span> + Fixed Capacity <span style="color:#fac858;">‚Äî</span>
            </p>
            <p class="small text-white mb-0" style="font-family: monospace;">
                = <span style="color:#ee6666;">Low Satisfaction ‚Üì</span>
            </p>
        </div>

    </div>
</div>

        <div class="col-lg-8 h-100">
            <div class="h-100 d-flex align-items-center justify-content-center" style="padding: 20px;">

                <img src="{{ url_for('static', filename='images/scale_trap_dark_v3.png') }}"
                     style="max-width: 100%; max-height: 90%; object-fit: contain;"
                     alt="Scale Trap Analysis">

            </div>
        </div>

    </div>
</div>

            <div id="tab-trend" class="tab-pane">
    <div class="row h-100 align-items-center g-5">

        <!-- Â∑¶‰æßÊñáÊ°à -->
        <div class="col-lg-4 h-100 d-flex flex-column justify-content-center">
            <div class="text-panel"
                 style="background: rgba(0,0,0,0.25);
                        border-left: 4px solid #91cc75;
                        padding: 28px;
                        backdrop-filter: blur(6px);">

                <h3 class="mb-3 text-uppercase" style="color: #91cc75; letter-spacing: 1px;">
                    SENTIMENT VS. MARGINS
                </h3>

                <p class="text-body-read mb-3">
                    Across the full sample period, Chipotle‚Äôs
                    <span class="text-highlight">customer sentiment drifts into negative territory</span>,
                    while <span style="color:#fac858; font-weight:bold;">operating margins reach record highs</span>.
                </p>


                <h5 class="text-uppercase mt-3 mb-2"
                    style="color: #ee6666; font-size: 0.95rem; font-weight:bold; letter-spacing: 1px;">
                    What the line chart shows
                </h5>

                <ul class="text-body-read mb-3" style="padding-left: 18px; font-size: 0.9rem;">
                    <li class="mb-1">
                        <span class="text-highlight">Pre-2020:</span> Sentiment is slightly positive and
                        margins are healthy but moderate.
                    </li>
                    <li class="mb-1">
                        <span class="text-highlight">2020‚Äì2022:</span> Demand and margin surge,
                        but sentiment starts to slide as stores run ‚Äúhot‚Äù for too long.
                    </li>
                    <li class="mb-1">
                        <span class="text-highlight">Linking to earlier charts:</span>
    Store share stays flat (no meaningful store expansion),
    but revenue jumps as each store handles more traffic.
    At the same time, the yearly <span class="text-highlight">average sentiment declines</span> ‚Äî
    consistent with the pattern:
                        <strong>flat store share + revenue surge ‚áí operational overload ‚áí rating drops.</strong>
                    </li>


                </ul>

                <div class="chart-note">
                    * Chart reading guide: the <strong>green line</strong> (left axis, ‚àí0.15 to 0.35)
                    tracks average customer sentiment; the <strong>gold line</strong> (right axis)
                    tracks operating margin. The growing gap visualizes the
                    <strong>‚Äúprofit‚Äìexperience‚Äù disconnect</strong>.
                </div>
            </div>
        </div>

        <!-- Âè≥‰æßÂõæË°® -->
        <div class="col-lg-8 h-100">
            <div class="chart-card-dark"
                 style="padding: 16px; position: relative; display: flex; flex-direction: column;">

                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <span class="badge rounded-pill"
                              style="background: rgba(145,204,117,0.2); color:#91cc75; font-size: 0.7rem;">
                            TREND VIEW
                        </span>
                        <h6 class="mt-2 mb-0 text-muted text-uppercase"
                            style="letter-spacing: 1px; font-size: 0.8rem;">
                            Customer Sentiment vs Operating Margin
                        </h6>
                    </div>
                </div>

                <div id="trend_chart" style="width: 100%; height: 60vh;"></div>
            </div>
        </div>

    </div>
</div>



        </div>
    </section>

    <section class="viewport" id="vp-voice">
        <div class="text-center text-white">
            <h1 class="display-1 fw-bold mb-4">THE VOICE</h1>
            <p class="fs-3 mb-5">Data tells us <em>what</em> happened.<br>Reviews tell us <em>why</em>.</p>
            <a href="/reviews" class="btn btn-lg btn-outline-light px-5 py-3 rounded-pill fs-4 fw-bold">
                READ CUSTOMER REVIEWS
            </a>
        </div>
    </section>

</div>

<script type="text/javascript">
    // 1. Scroll behavior (core feature)
    function scrollToSection(id) {
        const element = document.getElementById(id);
        element.scrollIntoView({ behavior: 'smooth' });
    }

    // 1. Initialize chart instances
var scatterChart = echarts.init(document.getElementById('scatter_chart'));
var barChart = echarts.init(document.getElementById('bar_chart'), 'dark');
var sentimentChart = echarts.init(document.getElementById('sentiment_chart'), 'dark');
var trendChart = echarts.init(document.getElementById('trend_chart'), 'dark');

// 2. Inject data from backend
var scatterOption  = {{ scatter_options   | safe }};
var barOption      = {{ bar_options       | safe }};
var sentimentOption= {{ sentiment_options | safe }};
var trendOption    = {{ trend_options     | safe }};

// 2.1 Fallback: if backend sends a string, try JSON.parse
function ensureObject(opt) {
    if (typeof opt === 'string') {
        try { return JSON.parse(opt); } catch (e) { return {}; }
    }
    return opt || {};
}

barOption       = ensureObject(barOption);
sentimentOption = ensureObject(sentimentOption);
trendOption     = ensureObject(trendOption);

// 3. Force transparent chart backgrounds
barOption.backgroundColor = 'transparent';
sentimentOption.backgroundColor = 'transparent';
trendOption.backgroundColor = 'transparent';



    // 4. Apply options to charts
    scatterChart.setOption(scatterOption);
    barChart.setOption(barOption);
    sentimentChart.setOption(sentimentOption);
    trendChart.setOption(trendOption);

    // 5. Tab switching logic
    function openTab(evt, tabName) {
        var i, tabPane, tabBtn;

        // Hide all panes
        tabPane = document.getElementsByClassName("tab-pane");
        for (i = 0; i < tabPane.length; i++) {
            tabPane[i].classList.remove("active");
        }

        // Remove active state from all tab buttons
        tabBtn = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tabBtn.length; i++) {
            tabBtn[i].classList.remove("active");
        }

        // Show the selected pane
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");

        // === Key fix: ensure Trend chart resizes after tab becomes visible ===
        setTimeout(function(){
            if(tabName === 'tab-sentiment') {
                barChart.resize();
                sentimentChart.resize();
            }
            if(tabName === 'tab-trend') {
                // This is critical because charts cannot compute width while display:none
                trendChart.resize();
            }
        }, 100);
    }

    // 6. Resize charts on window resize
    window.onresize = function() {
        scatterChart.resize();
        barChart.resize();
        sentimentChart.resize();
        trendChart.resize();
    };
</script>

</body>
</html>
